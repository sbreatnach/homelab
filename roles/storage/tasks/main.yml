# Veracrypt, NFS, Samba + fstab config
- name: install apt packages
  apt: name={{ item.name }}{% if item.version is defined %}={{ item.version }}*{% endif %}
       state=present
  with_items: "{{ storage.apt_packages }}"

- name: install deb packages
  apt: deb={{ item.path }} state=present
  with_items: "{{ storage.deb_packages }}"

- name: configure NFS exports
  template:
    src: exports.j2
    dest: /etc/exports

- name: configure Samba mounts
  template:
    src: smb.conf.j2
    dest: /etc/samba/smb.conf

- name: enable extra disks
  ansible.posix.mount:
    path: "{{ item.path }}"
    src: "{{ item.device }}"
    fstype: "{{ item.filesystem }}"
    opts: "{{ item.flags }}"
    state: present
  when: item.device is defined
  with_items: "{{ partitions }}"

- include: postgresql.yml